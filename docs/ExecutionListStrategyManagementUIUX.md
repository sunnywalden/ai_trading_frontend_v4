# 执行列表 + 策略管理 UI/UX 设计

## 1. 目标与范围
该文档基于 `docs/Product/ExecutionListStrategyManagementRequirements.md` 的需求描述，目标是补齐前端的 UI/UX 方案，使执行列表承载策略管理的能力：包括内置/自定义策略列表、策略运行触发与异步可视化、最近一次运行聚焦卡片、历史扫描记录页面、以及相关的提示/交互体验。

范围涵盖：
- 执行列表页面的主要区块与交互改造；
- 策略运行的异步状态反馈与最近结果呈现；
- 历史扫描记录的筛选、导出与复盘流程；
- 基于权限、运行失败、参数调整等场景的提示与通知；
- 对各组件（卡片、表格、进度条、过滤器）的视觉/交互指导。

## 2. 用户角色与核心旅程
### 2.1 用户角色
| 角色 | 目标 | 关键交互 | 成功指标 |
| --- | --- | --- | --- |
| 交易员 | 快速获得符合策略条件的候选标的并发起执行 | 在执行列表选择策略→编辑参数→运行→查看最近结果→推送执行 | 策略命中标的数量、推送执行次数、执行决策时间 | 
| 策略工程师 | 维护私募级策略库并调优参数 | 查看策略详情卡→调整参数→保存版本→共享 | 策略覆盖率、自定义策略复用 | 
| 研究/风控 | 回顾历史策略表现并复盘 | 进入历史记录页→筛选/导出→复盘 | 复盘报告数量、历史回溯时间 | 

### 2.2 典型任务流
1. **策略选择与运行**：在执行列表顶部打开策略管理卡片 → 使用筛选器定位“事件驱动趋势发现”策略 → 查看信号维度与参数 → 选择账户/预算/方向 → 命名本次运行并触发异步任务。
2. **弹性反馈**：页面展示任务 ID、状态徽章、进度条；当状态更新为“完成”时，最近一次运行卡片换成该任务的结果；若失败则自动展示失败原因并允许重试。
3. **历史复盘**：从最近一次运行卡片或侧边导航进入“历史扫描记录”→ 筛选出上周运行的“动量轮动”→ 展开某条记录查看标的详情与风控提示 → 点击“复盘”按钮生成复盘报告或重新运行。

## 3. 信息架构与布局
### 3.1 执行列表主视图
```
┌──────────────────────────────────────────────────────────────┐
│ 执行列表 Header （账户选择、同步状态、全局操作按钮）              │
├──────────────────────────────────────────────────────────────┤
│ 策略管理卡片（筛选器、策略列表、运行控件）                       │
├────────────────────────────────────────────────────────────────┤
│ 最近一次策略运行卡片（最新结果、标的、操作入口）                  │
├────────────────────────────────────────────────────────────────┤
│ 执行指令 Table（原有执行列表内容，保持滚动）                       │
└──────────────────────────────────────────────────────────────┘
```

### 3.2 核心区块说明
- **Header 区**：保持账户选择、同步状态与快捷操作按钮（如“刷新信号”、“同步 Tiger”）。新增信息提示条，展示当前策略运行任务数/排队数。
- **策略管理卡片**：左侧为风格/是否自定义/行业/时效筛选器；右侧为策略列表（卡片式展示，包括策略名称、简述、默认周期、最近一次运行结果）。每条策略卡可展开显示信号维度、适配品种、最近变更记录与“运行”按钮。
- **最近一次策略运行卡片**：默认显示最近成功运行（若无成功记录则显示最后一次执行状态）。展示策略名、运行状态、命中标的（Top5），每条标的附带收益方向图标、信号强度得分与是否触发风控。底部有“进入历史”与“一键推送执行计划”按钮。
- **执行指令 Table**：保持原样，但可追加列（如“策略来源”、“运行 ID”），与策略管理卡片联动，当策略运行完成后可选择将标的打包到执行计划内。

## 4. 策略管理卡片细节
### 4.1 策略列表卡片规范
- **卡片尺寸**：宽度填满卡片区，使用浅灰背景（#0F141D），内框阴影突出；卡片高度 160px 左右。
- **卡片内容**：左侧顶部展示策略名称 + 风格标签（例如 `事件驱动` `量化动量`），下方说明文本（最多两行），底部显示信号维度图标集合（技术、舆情、公告等）。右侧为参数预览（周期、目标涨幅、最大持仓）与按钮组（“查看信号”、“运行策略”）。
- **状态徽章**：卡片右上角显示 `最近运行` 状态（绿色=成功、蓝=排队、橙=执行中、红=失败）并显示时间戳。
- **筛选器与搜索**：支持关键字搜索策略名、支持“自定义/平台”切换、行业快速标签（如“新能源”、“消费”），以及“运行频率”（日/周/即时）与“最后运行时间”排序。
- **策略详情展开**：点击“查看信号”可下拉展开信号维度列表与数据源 badge，展示每类信号的权重与说明，并列出最近一次触发情况。

### 4.2 参数编辑与策略运行交互
- 弹出层 modal：选中策略点击“运行”弹出参数配置窗。默认填充策略的 `default_params`，用户可修改扫描周期、预算、方向、最大持仓数量。底部有“重置为默认”与“保存为自定义策略”按钮。
- 参数校验：提前在前端校验（如预算需大于最小预算、周期为整数），非法时禁用“确认运行”并显示提示文本。
- 运行确认：按下“运行”后，显示 loading 状态并调用 `/api/v1/strategies/{id}/run`，组件会立即呈现 task HUD（Status badge + progress ghost pill）。

## 5. 最近一次策略运行卡片设计
- **默认行为**：优先显示最近 72 小时内状态为 SUCCESS 的记录；若无成功记录，则显示最后执行记录并在右上角标明当前状态（例如 `上次运行失败`）。
- **卡片结构**：
  - Header：策略名 + 状态徽章 + 运行时间。
  - 主体：最多展示 5 个标的的 `Symbol Pill`，每个 pill 包含：标的/方向标签、信号强度条（0-100）、推荐理由摘要、风控 icon（若触发）。
  - Footer：三个 action button —— “进入历史记录”、“推送执行计划”、“导出标的列表”。
- **交互**：点击标的可右侧弹出小卡展示更详细信号（如技术因子 + 风控提示）；鼠标悬浮时展示 tooltip 说明该标的的信号值与触发条件。

## 6. 异步执行可视化与通知
- **任务 HUD**：策略运行后，在策略卡 + 最近运行卡片上均出现 `Task Badge` 显示 `RUNNING`/`QUEUED`/`COMPLETED`，并可展开查看执行节点（如 `Signal Generation`、`Risk Filter`、`Result Delivery`）。
- **进度条设计**：浅色背景横条，搭配三段节点指示。每个节点在完成后变绿；若失败则变红并显示错误简述。进度条下方支持“取消运行”按钮（若任务仍可取消）与“复制 run_id”。
- **主动通知**：任务完成（成功/失败）时通过右上角 toast 提示，内容带 `strategy_run_id` 与简短总结，并提供“查看结果”快速跳转。若失败且 retry 次数耗尽，则将错误 details 显示在 toast 及 run log 弹窗中；用户可点击“反馈给风控”以触发钉钉/邮件。
- **实时更新**：前端会每 3 秒轮询 `/api/v1/strategy-runs/{run_id}/status`（任务仍处于非 terminal 状态）并更新 HUD 与最近运行卡片；任务完成后立即调用 `/api/v1/strategy-runs/latest` 以刷新卡片数据。

## 7. 历史扫描记录页面
- **入口**：可在侧边导航、新增 Tab（Execution List→历史扫描）或最近运行卡片底部按钮进入。
- **页面结构**：
```
┌────────────────────────────────────────┐
│ Header（搜索 + 策略/账户/状态/时间筛选 + 导出按钮 + 复盘按钮） │
├────────────────────────────────────────┤
│ Runs Table（每行展示策略名/run id/状态/耗时/命中数/信号强度） │
├────────────────────────────────────────┤
│ Detail Drawer（点击单行展开：参数快照 + 标的列表 + 错误日志） │
└────────────────────────────────────────┘
```
- **Runs Table 说明**：
  - 状态列使用颜色块（绿/蓝/橙/红）与 icon 表示；
  - 命中数列展示“命中/扫描总数”格式，并附带小提示（如“70% 命中率”）；
  - 信号强度列显示平均分 + 历史趋势 sparkline；
  - 每行末尾有“复盘”按钮（将参数 + 标的复制到运行 modal）与“导出”按钮（请求后端 `/strategy-runs/{run_id}/export` 并返回 CSV 链接）。
- **Detail Drawer**：
  - 参数板块：展示 `strategy_run_params` + 是否为手动/计划运行；可复制 JSON。 
  - 标的板块：表格列出每个标的的信号分、权重、风控提示；支持按信号分排序。
  - 错误/日志板块：若失败，展示自动记载的错误信息与重试次数。

## 8. 权限与安全提示
- 策略管理入口对无 `strategy_execute` 权限的用户显示禁用状态，并且在 hover 时说明“需策略执行权限可见”。
- 自定义策略运行前需要 double confirm（确认参数是否会覆盖已有计划），若用户权限不足，则提示“请联系管理员申请策略执行权限”。
- 当运行任务因为权限/风控拦截失败时，在最近运行卡片与 toast 上同步展示“失败原因/具体字段”，并引导链接至风控联系信息。

## 9. 响应式与辅助行为
- **桌面端**：执行列表卡片使用两栏布局（策略卡 + 最近运行），当宽度小于 1280px 时，卡片堆叠；当进一步缩窄时“历史记录”按 Tab 式隐藏在底部。
- **平板/移动端**：策略卡片变为列表，运行按钮固定在底部；执行指令 table 简化为卡片列表，在某些卡片上提供“查看详情”按钮跳转。
- **加载与空态**：如果尚未跑过策略，策略卡片区域展示“暂无策略运行记录”，并在旁边提供“立即运行” CTA；历史记录页展示空态说明与视频教程链接。
- **辅助功能**：所有按钮均支持键盘导航；策略列表支持 type-to-search；状态 badge 提供 `aria-label` 供屏幕阅读器读取。

## 10. 参考 API 与数据契约
| 功能 | 前端调用 | 说明 |
| --- | --- | --- |
| 获取策略列表 | `GET /api/v1/strategies` | 策略 metadata 用于策略卡片与弹窗基础数据。支持 `style`、`is_builtin`、`industry` 过滤字段。 |
| 策略详情 | `GET /api/v1/strategies/{id}` | 填充展开区域的信号维度、数据源信息、默认参数。 |
| 运行策略 | `POST /api/v1/strategies/{id}/run` | 请求 body 包含账户/预算/方向/参数快照。需要权限 token。 |
| 任务状态 | `GET /api/v1/strategy-runs/{run_id}/status` | 轮询更新 HUD；如 status=FAILED 需展示 `error_message`。 |
| 最近运行 | `GET /api/v1/strategy-runs/latest` | 用于最近运行卡片数据刷新。
| 历史记录 | `GET /api/v1/strategy-runs` | 支持 `strategy_id`, `account`, `status`, `start_date`, `end_date` 过滤，返回分页结果。
| 记录详情 | `GET /api/v1/strategy-runs/{run_id}/results` | 填充 detail drawer 中的标的/信号数据。 |
| 导出 | `POST /api/v1/strategy-runs/{run_id}/export` | 后端生成 CSV 后返回下载链接，前端显示通知并提供 link。 |

## 11. 验收准则
- 策略管理卡片内策略列表可筛选、展开、运行；运行后能看到异步进度与 HUD；最近运行卡片自动刷新最新结果。
- 历史扫描记录页面能准确展示分页数据、支持多维筛选、展开详情、导出与复盘。
- 没有权限的用户无法运行策略，提示文字清晰无歧义；运行失败时状态与错误可见且可复试。
- 移动/平板端保持可访问交互，键盘 + 无障碍属性具备。
- 与后端 API 契约一致，所有数据字段已映射并适配到组件展示。

## 12. 依赖与风险
- 依赖任务状态通知与 `strategy-runs/latest` API 的低延迟反馈；若接口慢或失败，需设计 fallback（如 10 秒未更新则提示后端拥堵）。
- 策略运行涉及大量标的数据展示，需在分页/虚拟列表与底层数据契约间权衡，避免渲染卡顿；建议使用虚拟滚动。
- 需与设计/产品确认策略卡片的视觉风格、标签颜色与图标合集，以保持与现有执行列表风格一致。
